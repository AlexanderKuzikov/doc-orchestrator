# Glossary — DocOrchestrator

Краткий словарь терминов, используемых в проекте DocOrchestrator: от пайплайна обработки документов до настроек локального инференса (LM Studio / GGUF).

## Термины проекта

**DocOrchestrator** — config-first оркестратор обработки документов: вход (PDF/сканы) → артефакты → тип документа → извлечение полей → валидация/верификация → отчёты.

**Пайплайн (pipeline)** — последовательность стадий обработки (атомов), которые выполняются по маршруту и могут включаться/выключаться конфигом.

**Атом / стадия (stage)** — изолированный шаг пайплайна (например, `rasterize` / `router` / `extract` / `evaluate`) с чётким контрактом по входным/выходным артефактам.

**Короткий маршрут** — упрощённый режим разработки: растрирование → извлечение → добавление docTypes (без сегментации/split и без сложной предобработки).

**root.json** — корневой конфиг, управляющий маршрутом, путями, включением стадий, моделями и профилями запуска.

**docTypes/*.json** — конфиги типов документов (паспорт, ЕГРЮЛ и т.д.): признаки, список полей, схемы, параметры извлечения и валидации.

**staging/** — рабочая зона, где хранятся артефакты обработки (растры страниц, кропы, промежуточные JSON) для переиспользования при перезапусках.

**Артефакт (artifact)** — файл/JSON, который является результатом стадии и используется следующими стадиями (например, `pages/r150/*.webp`, `document.json`).

**manifest.json** — «паспорт» обработки: что сделано, какими версиями конфигов/моделей, где лежат артефакты, плюс метрики (время, точность, ошибки).

**Профилирование (timing/profiling)** — замер времени на всех стадиях (включая растрирование), чтобы находить узкие места и сравнивать режимы обработки.

## Документы и изображения

**Растрирование (rasterize)** — преобразование PDF-страниц (вектор/текст/скан) в изображения фиксированного разрешения для подачи в VLM и дальнейшей обработки.

**DPI (dots per inch)** — разрешение рендера при растрировании PDF; влияет на размер изображения и читаемость мелкого текста.

**Пирамида DPI** — сохранение нескольких разрешений одной и той же страницы (например 100/150/200/250/300 DPI) ради ускорения и A/B‑тестов точности.

**WebP (lossless)** — формат изображения, который удобно хранить как артефакт: компактнее PNG при сохранении качества.

**bbox (bounding box)** — прямоугольник (обычно `[x1, y1, x2, y2]`) в координатах изображения, задающий область документа/поля/фрагмента для нарезки (crop).

**Splitter / Segmenter** — стадия обнаружения нескольких документов на одном листе и нарезки на отдельные изображения по bbox.

**Предобработка (preprocess/enhance)** — улучшение изображения перед извлечением (deskew, контраст, шумоподавление и т.п.), выполняемое на CPU как дешёвый способ поднять точность.

**Deskew** — устранение перекоса документа на изображении: оценка угла наклона (обычно в пределах ±5–10°) и поворот до «ровного» вида для улучшения читаемости текста.

**Каскадный deskew (VLM + CV)** — двухэтапный подход:
- быстрая VLM грубо определяет поворот на 0/90/180/270 градусов (правильная сторона документа);
- классическая CV-библиотека (например OpenCV) дорабатывает небольшой наклон (±несколько градусов) алгоритмом deskew.

## Модели и извлечение

**VLM (Vision-Language Model)** — модель, принимающая изображение и текстовую инструкцию (промпт) и выдающая ответ (в идеале — структурированный JSON).

**Router (быстрая модель)** — стадия быстрого анализа:
- определение типа документа;
- грубая оценка ориентации (0/90/180/270);
- детекция «комбо-сканов» (несколько документов на одном листе).

**Extractor (старшая модель)** — стадия извлечения целевых полей в JSON по типу документа, обычно более тяжёлая/точная VLM или LLM.

**Промпт (prompt)** — текстовая инструкция модели, которая фиксирует формат ответа (JSON-only), список полей и правила извлечения.

**JSON-only** — требование к модели возвращать только JSON без пояснений, чтобы результат был детерминированно парсабельным.

**Retry prompt** — повторный запрос к модели при провале валидации: короткая инструкция «исправь только эти поля/ошибки, JSON-only».

## Качество и метрики

**Валидация (validation)** — проверка формата/типа/обязательности полей (часто через JSON Schema и регулярки).

**Нормализация (normalization)** — приведение значений к каноническому виду (даты, пробелы, регистр, типографика, единый формат).

**Верификация (verification)** — доменные проверки и согласованность (контрольные суммы, диапазоны, взаимосвязи полей).

**Ground Truth** — эталонный (ручной) JSON‑результат для документа, используемый для измерения точности и поиска регрессий.

**Evaluator** — компонент, сравнивающий фактический JSON с эталонным и считающий метрики (accuracy по полям, ошибки, время обработки).
