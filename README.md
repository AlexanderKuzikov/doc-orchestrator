# DocOrchestrator (doc-orchestrator)

DocOrchestrator — это config-first оркестратор обработки документов: конвейер для растрирования PDF, определения типа документа и извлечения полей данных с использованием локальных VLM, с усиленной валидацией, нормализацией и верификацией результатов в структурированный JSON.

## Зачем это нужно

Цель проекта — превратить "папку со сканами" в воспроизводимый, расширяемый и измеримый процесс извлечения данных: документ → тип → набор полей → проверенный результат.

Проект ориентирован на работу в закрытом контуре (local-first): модели, обработка и артефакты находятся локально, без обязательного облака.

## Ключевые принципы

- **Конфигурация важнее кода**: типы документов, модели, папки, правила именования и этапы задаются через JSON и могут управляться будущим UI.
- Многофазный пайплайн: быстрый роутинг (маленькая VLM) → точное извлечение полей (основная VLM) → постобработка.
- Достоверность данных достигается не только моделью, но и детерминированными правилами: валидация форматов, нормализация и верификация (логика проверки/согласованности/доменных ограничений).
- Каждая стадия атомарна и отключаема через конфигурацию (позже — через UI).

## Возможности (план проекта)

- Вход: PDF-файлы в папке (в т.ч. "один документ = несколько PDF в подпапке").
- Растрирование страниц в несколько разрешений (например 100 DPI для роутинга и 300 DPI для извлечения).
- Определение типа документа локальной VLM и создание стартового JSON (минимум: `doc_type`).
- Сортировка исходных документов по папкам типов + хранение артефактов обработки рядом (JSON, изображения, манифесты).
- Извлечение полей по типу документа в JSON по схеме, с правилами обязательности/форматов и последующей нормализацией.
- Отчёты, логи, статистика ошибок/отказов и тестовый прогон для сравнения моделей/предобработок (позже).

## Конфигурация

Проект использует JSON-оркестратор: `root`-конфиг + папка с типами документов (`docTypes/`), где каждый тип описывается отдельным JSON-файлом и подхватывается автоматически при старте.

Ожидаемая структура (может меняться по мере реализации):

- `config/root.json` — пути, включение этапов, модели, шаблоны именования.
- `config/docTypes/*.json` — описания типов документов (id, признаки, целевые поля, правила).
- `config/schema/*.schema.json` — JSON Schema для валидации конфигов (чтобы ловить ошибки на старте).

## Быстрый старт (появится позже)

Сейчас проект в стадии активной разработки. Когда базовый MVP будет готов, здесь появятся:

- требования к окружению (Poppler/pdftoppm, Node.js, локальный inference-раннер),
- команды запуска,
- пример конфигов и демо-датасет.

## Дорожная карта (MVP по шагам)

- [ ] Шаг 1: обнаружение входящих документов + растрирование (100/300 DPI) с сохранением артефактов.
- [ ] Шаг 2: определение типа документа (router VLM) + стартовый `document.json`.
- [ ] Шаг 3: раскладка по папкам `<doc_type>/<seq>/` и перенос/архивация исходников.
- [ ] Шаг 4: извлечение полей основной VLM по типу + строгая валидация/нормализация/верификация.
- [ ] Шаг 5: тестовый раннер, отчёты качества и удобная админка конфигураций.

## Лицензия

Проект распространяется под лицензией [Apache License 2.0](LICENSE).

## Автор

Создан и поддерживается [AlexanderKuzikov](https://github.com/AlexanderKuzikov).
